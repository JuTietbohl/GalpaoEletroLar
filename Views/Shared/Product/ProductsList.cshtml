@model List<GalpaoEletroLar.Models.CadastroProduto>

@foreach (var product in Model)
{
    var maisDeTresMeses = product.DataEntrada <= DateTime.Now.AddMonths(-3);
    var estoqueAlto = product.Quantidade > 5;
    var preco = product.Preco;
    bool promo = (maisDeTresMeses && estoqueAlto);
    preco = promo ? preco * 0.9m : preco;
    bool semEstoque = product.Quantidade <= 0;

    <div class="produto-card">
        <div class="produto-conteudo">
            <!-- Nome e tipo -->
            <div class="produto-info">
                <i class="fa-regular fa-refrigerator icone-produto"></i>
                <div class="produto-detalhes">
                    <h6 class="produto-nome">@product.Nome</h6>
                    <small class="produto-tipo">
                        @(product.Tipo == TIPO.MOVEL ? "Móvel" : "Eletrodoméstico")
                    </small>
                </div>
            </div>

            <!-- Preço -->
            <div class="produto-preco">
                @if (promo)
                {
                    <div class="preco-promocional">
                        <span class="preco-antigo">@String.Format("R$ {0:N2}", product.Preco)</span>
                        <span class="preco-novo">@String.Format("R$ {0:N2}", preco)</span>
                    </div>
                }
                else
                {
                    @String.Format("R$ {0:N2}", product.Preco)
                }
            </div>

            <!-- Estoque -->
            <div class="produto-quantidade @(semEstoque ? "sem-estoque" : "")">
                @if (semEstoque)
                {
                    <span>Sem estoque</span>
                }
                else if (product.Quantidade < 5)
                {
                    <div class="estoque-baixo">
                        <span>Quantidade: @product.Quantidade</span>
                        <span class="alerta">Estoque baixo</span>
                    </div>
                }
                else
                {
                    <span>Quantidade: @product.Quantidade</span>
                }
            </div>

            <!-- Data -->
            <div class="produto-data">
                @product.DataEntrada.ToString("dd/MM/yyyy")
            </div>

            <!-- Ações -->
            <div class="produto-acoes">
                <button class="btn-icone btn-detalhes" onclick="carregarModalDetalhes(@product.Id)" aria-label="Ver detalhes">
                    <svg class="icone-svg" xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 22 22" fill="none">
                        <path d="M21.6425 4.94015C22.1192 4.46355 22.1192 3.66921 21.6425 3.21705L18.7829 0.35745C18.3308 -0.11915 17.5365 -0.11915 17.0599 0.35745L14.8113 2.59381L19.394 7.1765M0 17.4173V22H4.5827L18.0986 8.47188L13.5159 3.88918L0 17.4173Z" fill="currentColor"/>
                    </svg>
                </button>

                <button class="btn-icone btn-vender" data-bs-toggle="modal" data-bs-target="#modalVender" aria-label="Vender produto">
                    <svg class="icone-svg dolar-sign" xmlns="http://www.w3.org/2000/svg" width="16" height="27" viewBox="0 0 16 27" fill="none">
                        <path d="M15.32 18.06C15.32 19.06 15.07 20 14.57 20.88C14.09 21.76 13.37 22.5 12.41 23.1C11.47 23.7 10.35 24.06 9.05 24.18V26.61H7.1V24.18C5.22 24 3.7 23.41 2.54 22.41C1.38 21.41 0.8 20.09 0.8 18.45H4.46C4.52 19.23 4.77 19.88 5.21 20.4C5.65 20.9 6.28 21.22 7.1 21.36V14.76C5.76 14.42 4.67 14.08 3.83 13.74C2.99 13.38 2.27 12.82 1.67 12.06C1.09 11.3 0.8 10.26 0.8 8.94C0.8 7.28 1.38 5.91 2.54 4.83C3.7 3.73 5.22 3.09 7.1 2.91V0.479999H9.05V2.91C10.81 3.07 12.22 3.63 13.28 4.59C14.36 5.53 14.97 6.83 15.11 8.49H11.45C11.39 7.87 11.15 7.32 10.73 6.84C10.31 6.34 9.75 6 9.05 5.82V12.3C10.39 12.62 11.48 12.96 12.32 13.32C13.16 13.66 13.87 14.21 14.45 14.97C15.03 15.71 15.32 16.74 15.32 18.06ZM4.28 8.76C4.28 9.58 4.52 10.22 5 10.68C5.5 11.14 6.2 11.51 7.1 11.79V5.73C6.24 5.83 5.55 6.14 5.03 6.66C4.53 7.18 4.28 7.88 4.28 8.76ZM9.05 21.36C9.93 21.22 10.62 20.87 11.12 20.31C11.62 19.73 11.87 19.04 11.87 18.24C11.87 17.44 11.62 16.82 11.12 16.38C10.64 15.92 9.95 15.55 9.05 15.27V21.36Z" fill="currentColor"/>
                    </svg>
                </button>

                <button class="btn-icone btn-excluir" data-bs-toggle="modal" data-bs-target="#modalExcluir"
                        onclick="prepararExclusao(@product.Id, '@product.Nome')" aria-label="Excluir produto">
                    <svg class="icone-svg trash" xmlns="http://www.w3.org/2000/svg" width="19" height="24" viewBox="0 0 19 24" fill="none">
                        <path d="M19 1.33333H14.25L12.8929 0H6.10714L4.75 1.33333H0V4H19M1.35714 21.3333C1.35714 22.0406 1.64311 22.7189 2.15214 23.219C2.66117 23.719 3.35156 24 4.07143 24H14.9286C15.6484 24 16.3388 23.719 16.8479 23.219C17.3569 22.7189 17.6429 22.0406 17.6429 21.3333V5.33333H1.35714V21.3333Z" fill="currentColor"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>
}
